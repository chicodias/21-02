---
title: "Lista3 - Grupo3"
author: 
  - Brenda da Silva Muniz 11811603
  - Francisco Rosa Dias de Miranda 4402962
  - Heitor Carvalho Pinheiro 11833351
  - Mônica Amaral Novelli 11810453
date: "23/11/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(tidyverse)
library(ggpubr)
library(FSA)
```

6) Considere o teste da falta de ajuste para o modelo de regressão linear simples. Obtenha
E(QMres). Desenvolva passo a passo colocando todos os detalhes.

7) Uma empresa fabricante de garrafas de vidro registrou dados sobre a quantidade média de
defeitos por 10 000 garrafas, devido a pedras (pequenas pedras embutidas na parede da garrafa)
e a quantidade de semanas a partir da última reparação geral feita no forno.

```{r dados07}
#definindo os dados
defeitos <- c(13.00, 16.10, 14.50, 17.80, 22.00, 27.40, 16.80, 34.20, 65.60, 49.20, 66.20,81.20,87.40, 114.50)

semanas <- c(seq(4,17))

df <- data.frame(defeitos, semanas)

View(df)
```
a)
## Ajustando um modelo de regressão linear MMQ

```{r}
fit1 <- lm(defeitos ~ semanas, data = df)
summary(fit1)
```
## Plotando o modelo ajustado

```{r}
ggplot(df, aes(x=semanas, y=defeitos)) +
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  theme_pubclean()
  
```
Percebemos que os atributos *semanas* e *defeitos* apresentam certa linearidade, com um $R^2_{aj} = 0.84$. Porém, precisamos verificar os resíduos para determinar a adequabilidade do modelo.

### Gráfico de Resíduos

```{r}
FSA::residPlot(fit1)
```
O gráfico de resíduos acima nos indica que os resíduos não são lineares, apesar da distribuição deles parecer ser Normal, de acordo com o histograma ao lado.

```{r}
ggplot(df, aes(x = fit1$fitted.values, y = fit1$residuals)) +
  geom_point() + 
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_smooth()
```


Isso significa que ainda existe alguma relação entre as variáveis que o modelo de regressão linear simples não é capaz de detectar.

Devido a isso, precisamos realizar algumas transformações no nosso modelo.

b) 

Uma vez que os resíduos apresentam um comportamento semelhante a uma função quadrática, ajustaremos uma regressão polinomial de grau 2.

## Ajustando um modelo de regressão polinomial

```{r}
fit2 <- lm(defeitos ~ poly(semanas,2), data = df)
summary(fit2)
```
Percebemos que o modelo polinomial é muito melhor para explicar a variabilidade nos dados, alcançando um $R^2_{aj} = 0.94$.

```{r}
#usando o ggplot
ggplot(df, aes(x=semanas, y=defeitos)) +
  geom_point() +
  stat_smooth(method = "lm", formula = y ~ poly(x,2), col = "red") +
  theme_pubclean()
```
## Gráfico dos resíduos para o modelo polinomial

```{r}
ggplot(df, aes(x = fit2$fitted.values, y = fit2$residuals)) +
  geom_point() + 
  geom_hline(yintercept = 0, linetype = "dashed") +
  geom_smooth()
```
O modelo polinomial apresenta resíduos bem menos correlacionados que o modelo mínimos quadrados, o que garante uma melhor adequalibilidade.
